
测试 localhost http 的瓶颈都在CPU。

为什么这样说,

1. localhost 的带宽的上线是内存的上限。
我们假设内存可以 20000m/s 的写入和读取。
localhost的一个RTT，我们假设1ms，那么带宽上线就是 20000m/1ms = 20,000,000 m/s。

2. tcp 的滑动窗口
不是你带宽有多高，tcp就能发多快的。在开启 net.ipv4.tcp_window_scaling, 可以带到1GB。那么假设RTT 延迟 1ms。那么我们带宽上线就是
1024m/1ms = 1,024,000 m/s

所有我们得出，我们的带宽上线是 1,024,000 m/s

如果假设我们一个 http 的请求是 10kb，如果达到带宽上线，我们 qps 应该是 1,024,000 m/10kb = 100,024,000 /s. 天文数字。

3. 让我们假设我们 CPU 处理一个 socket 事件的时间是 1us（已经是很快了）
那么 1s 可以处理多少请求的呢， 1s/1us = 1,000,000 /s

因为 node 用的是 epoll， 让我们假设一个 http 请求是 10kb，以为一个 tcp 报文是 1kb。那么 1 个 http 大概率请求就会产生 10 个 socket 事件。让我们少估计一点，就产生5个事件吧。那么 1s 处理 1,000,000 事件，就等于能处理了 500,000 个 10kb， 也就等于 500,000 * 0.01m = 5000m
